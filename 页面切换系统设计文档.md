# 页面切换系统设计文档

## ⚠️ 重要警告：请在修改前仔细阅读本文档

### 问题回顾
在开发页面切换系统时，AI曾经犯了一个严重的设计错误：
- 将Apple page设计为独立容器，与其他页面分离
- 导致Apple page与其他页面间的切换出现不连贯的动画
- 造成"从第三页切回Apple page也会加载上滑页面动画"的离谱体验

**核心问题：** 没有理解整体的页面流逻辑，只关注局部实现

---

## 正确的设计原理

### 页面层级结构
```
Hero页面（独立）
    ↓ 上拉动画
页面系统（统一容器）
├── Apple page (第1页)
├── AI Coding (第2页)  
├── Design (第3页)
└── Photography (第4页)
    ↑ 页面间平滑切换
```

### 动画规则
1. **Hero ↔ 页面系统：** 特殊动画
   - Hero → Apple：上拉动画（整个容器从下方滑入）
   - Apple → Hero：下滑动画（整个容器滑回下方）

2. **页面系统内部：** 平滑切换
   - Apple ↔ AI：无特殊动画，只有平滑的transform
   - AI ↔ Design：无特殊动画，只有平滑的transform
   - 任意页面间：都是连续的垂直切换

### 技术实现要点

#### HTML结构
```html
<!-- Hero区域（独立） -->
<section class="hero">...</section>

<!-- 页面系统（统一容器） -->
<main class="page-container" id="pageContainer">
    <div class="page-inner" id="pageInner">
        <section class="page" data-page="1">Apple page</section>
        <section class="page" data-page="2">AI Coding</section>
        <section class="page" data-page="3">Design</section>
        <section class="page" data-page="4">Photography</section>
    </div>
</main>
```

#### CSS关键点
```css
/* 页面容器：负责与Hero间的切换动画 */
.page-container {
    transform: translateY(100vh); /* 初始隐藏在下方 */
    transition: transform 1000ms cubic-bezier(0.19, 1, 0.22, 1);
}

.page-container.active {
    transform: translateY(0); /* 上拉显示 */
}

/* 页面内容：负责页面间的平滑切换 */
.page-inner {
    height: 400vh; /* 4页 × 100vh */
    transition: transform 1000ms cubic-bezier(0.19, 1, 0.22, 1);
}
```

#### JavaScript逻辑
```javascript
// 进入页面系统（上拉动画）
function enterPageMode() {
    pageContainer.classList.add('active'); // 触发上拉
    currentPage = 0; // 默认显示Apple page
}

// 退出页面系统（下滑动画）  
function exitPageMode() {
    pageContainer.classList.remove('active'); // 触发下滑
}

// 页面间切换（平滑transform）
function goToPage(pageIndex) {
    const translateY = -pageIndex * 100;
    pageInner.style.transform = `translateY(${translateY}vh)`;
}
```

---

## 禁止事项

### ❌ 绝对不要这样做：
1. **为特定页面创建独立容器**
   - 不要为Apple page或任何单独页面创建独立的容器
   - 所有内容页面必须在同一个.page-container中

2. **在页面间切换时添加特殊动画**
   - 页面系统内部的切换必须是连续的
   - 不要为Apple→AI或任何页面间切换添加额外动画

3. **破坏页面的连续性**
   - 页面必须像连续的滚动条一样工作
   - 每页100vh高度，垂直排列

### ❌ 错误示例：
```html
<!-- 错误：为Apple page创建独立容器 -->
<div class="apple-page-container">...</div>
<main class="page-container">
    <section class="page">AI Coding</section>
    <!-- 其他页面 -->
</main>
```

---

## 添加新页面的正确步骤

### 1. HTML结构
在`.page-inner`中添加新的页面section：
```html
<div class="page-inner" id="pageInner">
    <!-- 现有页面 -->
    <section class="page" data-page="5">
        <div class="page-content">
            <!-- 新页面内容 -->
        </div>
    </section>
</div>
```

### 2. 更新配置
```javascript
const CONFIG = {
    totalPages: 5, // 增加页面数量
    // 其他配置保持不变
};
```

### 3. CSS调整
```css
.page-inner {
    height: 500vh; /* 5页 × 100vh */
}
```

### 4. 键盘导航扩展
```javascript
// 数字键1-5：直接跳转
if (e.key >= '1' && e.key <= '5') {
    // 处理逻辑
}
```

---

## 测试检查清单

在完成页面切换系统的任何修改后，必须验证以下行为：

### ✅ 必须通过的测试：
1. **Hero → Apple：** 上拉动画流畅
2. **Apple → AI：** 平滑切换，无额外动画
3. **AI → Design：** 平滑切换，无额外动画  
4. **Design → Apple：** 平滑切换，无额外动画
5. **Apple → Hero：** 下滑动画流畅
6. **键盘1-4：** 直接跳转正确
7. **方向键：** 上下切换正确
8. **ESC键：** 从任何页面返回Hero

### ⚠️ 禁止出现的行为：
- 从其他页面返回Apple时出现上拉动画
- 页面间切换时出现闪烁或跳跃
- 页面位置错乱或重叠
- 切换过程中出现白屏

---

## 总结

**核心原则：保持简单，保持连续**

页面切换系统只有两个层级：
1. Hero（独立）
2. 页面系统（连续的内容页面）

特殊动画只存在于这两个层级之间，页面系统内部永远是平滑的连续切换。

**记住：页面系统就像一个长长的垂直滚动条，用户通过滚轮在其中导航。**

---

## 坐标系统错误记录

### 2025年错误案例：元素定位失效

#### 问题现象
- 页面元素（标题、描述、content-left容器）完全不可见
- 使用`!important`强制样式仍然无效
- 绿点调试显示正确位置，但文本元素消失

#### 根本原因分析
1. **坐标系统不统一**
   - CSS使用`vh`单位，但页面实际高度是919px
   - JavaScript页面切换逻辑：`translateY(-pageIndex * 100vh)`
   - 实际需要：`translateY(-pageIndex * 919px)`

2. **页面容器尺寸不匹配**
   - `.page`容器：`height: 100vh`（浏览器依赖）
   - 应该改为：`height: 919px`（固定尺寸）
   - `.page-inner`高度：`400vh` → `3676px`（4×919px）

3. **混合定位系统**
   - 部分元素使用相对定位+padding+transform
   - 部分元素使用绝对定位
   - 造成坐标系统混乱

4. **网格坐标计算错误**
   - 文档中格子3坐标：(730, 40)
   - 正确计算：(750, 40)
   - 差异20px导致所有元素偏移

#### 解决方案
1. **统一绝对坐标系统**
   ```css
   /* 统一使用px，禁用vh、%、transform */
   .page-container { width: 1470px; height: 919px; }
   .page { width: 1470px; height: 919px; }
   .page-content { top: 0; left: 0; transform: none; padding: 0; }
   ```

2. **修正JavaScript切换逻辑**
   ```javascript
   // 错误：const translateY = -pageIndex * 100;
   // 正确：
   const translateY = -pageIndex * 919;
   pageInner.style.transform = `translateY(${translateY}px)`;
   ```

3. **重新计算网格坐标**
   - 格子1: (20, 40) → 格子2: (385, 40) → 格子3: (750, 40)
   - 间距计算：20 + 335 + 30 = 385, 385 + 335 + 30 = 750

4. **文本对齐修正**
   ```css
   /* 移除居中对齐 */
   .page-title {
     /* display: flex; align-items: center; */ /* 删除 */
     margin: 0; padding: 0; /* 左上角对齐 */
   }
   ```

#### 核心教训
⚠️ **固定尺寸设计中绝对不能混用相对单位**
⚠️ **所有坐标系统必须基于同一套标准**
⚠️ **调试时优先检查容器定位，再检查元素定位**
⚠️ **网格坐标必须精确计算，不能靠估算**

#### 预防措施
1. 建立坐标系统时立即验证基准点
2. 使用调试点验证关键位置
3. 避免在固定尺寸项目中使用响应式单位
4. 坐标计算完成后立即更新文档